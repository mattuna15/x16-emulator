1 REM MIDI PLAYER
2 REM MIDIIN = $9FC2;
3 REM MIDIOUT = $9FC3;
4 REM S = $9FC4;
5 REM KEYCODE TABLE
6 DIM YMK(96)
7 PRINT "KEYTABLE LOADING" : FOR K=0 TO 95: READ KEY: YMK(K) = KEY: NEXT
10 PRINT "INIT YM2151" : FOR I=0 TO 255 :POKE $9FE0,I :POKE $9FE1,0 : NEXT 
20 PRINT "LOAD PATCHES" : FOR CH=0 TO 7 : GOSUB 10000 :NEXT 
30 REM
40 REM SET UP BASS NOTES ON CHANNELS 1-6
50 L=$E4-$C0+$40 :R=$E4-$C0+$80  :REM SETTINGS FOR LEFT/RIGHT AUDIO ONLY
60 FOR CH=1 TO 5 STEP 2
70 IF CH=1 THEN N=$0D
71 IF CH=3 THEN N=$14
72 IF CH=5 THEN N=$16
90 POKE $9FE0,$20+CH   : POKE $9FE1,L
91 POKE $9FE0,$20+CH+1 :POKE $9FE1,R
92 POKE $9FE0,$28+CH   : POKE $9FE1,N
93 POKE $9FE0,$28+CH+1 : POKE $9FE1,N+$10
94 NEXT CH
100 REM --- PLAY A NOTE ---
110 B = PEEK($9FC2)
111 S = PEEK($9FC4)
140 IF S <> 1 GOTO 110
141 PRINT "BYTE: ";: PRINT B
142 PRINT "STATUS: ";: PRINT S
150 IF O1 = 1 THEN GOSUB 500
160 IF O2 = 1 THEN GOSUB 600
170 IF B = $90 THEN O1=1
180 IF B = $80 THEN O2=1
190 GOTO 110
500 REM NOTE ON
510 PRINT "NOTE ON" 
520 POKE $9FE0,$28: POKE $9FE1, YMK(B)
530 POKE $9FE0,$08: POKE $9FE1, 08
540 B = 0
560 O1 = 0
570 RETURN
600 REM NOTE OFF
605 PRINT "NOTE OFF" 
610 B = PEEK($9FC2)
630 POKE $9FE0,$08: POKE $9FE1, $00
640 B = 0
660 O2 = 0
670 RETURN
9999 END
10000 REM SET CH= VOICE NUMBER AND GOSUB HERE TO LOAD PATCH
10001 POKE $9FE0,$80+CH: POKE $9FE1, $1F);
10002 POKE $9FE0,$A0+CH: POKE $9FE1, $0B);
10003 POKE $9FE0,$E0+CH: POKE $9FE1, $FF);
10004 POKE $9FE0,$20+CH: POKE $9FE1, $E7);
10031 RETURN

10040 DATA  $00, $01, $02, $04, $05, $06, $08, $09
10041 DATA  $0A, $0C, $0D, $0E, $10, $11, $12, $14
10042 DATA  $15, $16, $18, $19, $1A, $1C, $1D, $1E
10043 DATA  $20, $21, $22, $24, $25, $26, $28, $29
10044 DATA  $2A, $2C, $2D, $2E, $30, $31, $32, $34
10045 DATA  $35, $36, $38, $39, $3A, $3C, $3D, $3E
10046 DATA  $40, $41, $42, $44, $45, $46, $48, $49
10047 DATA  $4A, $4C, $4D, $4E, $50, $51, $52, $54
10048 DATA  $55, $56, $58, $59, $5A, $5C, $5D, $5E
10049 DATA  $60, $61, $62, $64, $65, $66, $68, $69
10050 DATA  $6A, $6C, $6D, $6E, $70, $71, $72, $74
10051 DATA  $75, $76, $78, $79, $7A, $7C, $7D, $7E



